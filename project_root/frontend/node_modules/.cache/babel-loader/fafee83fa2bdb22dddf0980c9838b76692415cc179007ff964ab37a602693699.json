{"ast":null,"code":"let speechRecognition;\nlet listening = false;\nexport function initSpeechRecognition(onTranscript) {\n  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n  if (!SpeechRecognition) {\n    console.error(\"Speech Recognition not supported\");\n    return null;\n  }\n  if (!speechRecognition) {\n    speechRecognition = new SpeechRecognition();\n    speechRecognition.continuous = true;\n    speechRecognition.interimResults = true;\n    speechRecognition.lang = 'en-US';\n    speechRecognition.onresult = event => {\n      const transcript = Array.from(event.results).map(result => result[0].transcript).join('');\n      const isFinal = event.results[event.results.length - 1].isFinal;\n      if (onTranscript) {\n        onTranscript(transcript, isFinal);\n      }\n\n      // ✅ If speaking and user talks → interrupt speech\n      if (!isFinal && window.speechSynthesis.speaking) {\n        window.speechSynthesis.cancel(); // stop speaking immediately\n      }\n    };\n    speechRecognition.onerror = e => {\n      console.error('SpeechRecognition Error:', e);\n      if (e.error === 'no-speech' || e.error === 'audio-capture') {\n        stopListening();\n        setTimeout(() => startListening(onTranscript), 2000); // auto-restart\n      }\n    };\n  }\n  return speechRecognition;\n}\nexport function startListening(onTranscript) {\n  const recognition = initSpeechRecognition(onTranscript);\n  if (!recognition || listening) return;\n  try {\n    recognition.start();\n    listening = true;\n  } catch (err) {\n    console.warn('Already listening or start failed:', err);\n  }\n}\nexport function stopListening() {\n  if (speechRecognition && listening) {\n    speechRecognition.stop();\n    listening = false;\n  }\n}\nexport function speakWithAudioFeedback(text, setVolume, onEnd) {\n  const synth = window.speechSynthesis;\n  if (!synth) return;\n  synth.cancel(); // cancel any ongoing speech first\n\n  const utter = new SpeechSynthesisUtterance(text);\n  utter.lang = 'en-US';\n  let volInterval;\n  utter.onstart = () => {\n    volInterval = setInterval(() => {\n      const fakeVol = Math.random(); // simulate volume bar\n      setVolume(fakeVol);\n    }, 100);\n  };\n  utter.onend = () => {\n    clearInterval(volInterval);\n    setVolume(0);\n    if (onEnd) onEnd();\n  };\n  utter.onerror = () => {\n    clearInterval(volInterval);\n    setVolume(0);\n    if (onEnd) onEnd();\n  };\n  synth.speak(utter);\n}\nexport function stopSpeaking() {\n  if (window.speechSynthesis && window.speechSynthesis.speaking) {\n    window.speechSynthesis.cancel();\n  }\n}","map":{"version":3,"names":["speechRecognition","listening","initSpeechRecognition","onTranscript","SpeechRecognition","window","webkitSpeechRecognition","console","error","continuous","interimResults","lang","onresult","event","transcript","Array","from","results","map","result","join","isFinal","length","speechSynthesis","speaking","cancel","onerror","e","stopListening","setTimeout","startListening","recognition","start","err","warn","stop","speakWithAudioFeedback","text","setVolume","onEnd","synth","utter","SpeechSynthesisUtterance","volInterval","onstart","setInterval","fakeVol","Math","random","onend","clearInterval","speak","stopSpeaking"],"sources":["H:/camera/project_root/frontend/src/utils/voice.js"],"sourcesContent":["let speechRecognition;\r\nlet listening = false;\r\n\r\nexport function initSpeechRecognition(onTranscript) {\r\n  const SpeechRecognition =\r\n    window.SpeechRecognition || window.webkitSpeechRecognition;\r\n\r\n  if (!SpeechRecognition) {\r\n    console.error(\"Speech Recognition not supported\");\r\n    return null;\r\n  }\r\n\r\n  if (!speechRecognition) {\r\n    speechRecognition = new SpeechRecognition();\r\n    speechRecognition.continuous = true;\r\n    speechRecognition.interimResults = true;\r\n    speechRecognition.lang = 'en-US';\r\n\r\n    speechRecognition.onresult = (event) => {\r\n      const transcript = Array.from(event.results)\r\n        .map(result => result[0].transcript)\r\n        .join('');\r\n      const isFinal = event.results[event.results.length - 1].isFinal;\r\n\r\n      if (onTranscript) {\r\n        onTranscript(transcript, isFinal);\r\n      }\r\n\r\n      // ✅ If speaking and user talks → interrupt speech\r\n      if (!isFinal && window.speechSynthesis.speaking) {\r\n        window.speechSynthesis.cancel(); // stop speaking immediately\r\n      }\r\n    };\r\n\r\n    speechRecognition.onerror = (e) => {\r\n      console.error('SpeechRecognition Error:', e);\r\n      if (e.error === 'no-speech' || e.error === 'audio-capture') {\r\n        stopListening();\r\n        setTimeout(() => startListening(onTranscript), 2000); // auto-restart\r\n      }\r\n    };\r\n  }\r\n\r\n  return speechRecognition;\r\n}\r\n\r\nexport function startListening(onTranscript) {\r\n  const recognition = initSpeechRecognition(onTranscript);\r\n  if (!recognition || listening) return;\r\n\r\n  try {\r\n    recognition.start();\r\n    listening = true;\r\n  } catch (err) {\r\n    console.warn('Already listening or start failed:', err);\r\n  }\r\n}\r\n\r\nexport function stopListening() {\r\n  if (speechRecognition && listening) {\r\n    speechRecognition.stop();\r\n    listening = false;\r\n  }\r\n}\r\n\r\nexport function speakWithAudioFeedback(text, setVolume, onEnd) {\r\n  const synth = window.speechSynthesis;\r\n  if (!synth) return;\r\n\r\n  synth.cancel(); // cancel any ongoing speech first\r\n\r\n  const utter = new SpeechSynthesisUtterance(text);\r\n  utter.lang = 'en-US';\r\n\r\n  let volInterval;\r\n\r\n  utter.onstart = () => {\r\n    volInterval = setInterval(() => {\r\n      const fakeVol = Math.random(); // simulate volume bar\r\n      setVolume(fakeVol);\r\n    }, 100);\r\n  };\r\n\r\n  utter.onend = () => {\r\n    clearInterval(volInterval);\r\n    setVolume(0);\r\n    if (onEnd) onEnd();\r\n  };\r\n\r\n  utter.onerror = () => {\r\n    clearInterval(volInterval);\r\n    setVolume(0);\r\n    if (onEnd) onEnd();\r\n  };\r\n\r\n  synth.speak(utter);\r\n}\r\n\r\nexport function stopSpeaking() {\r\n  if (window.speechSynthesis && window.speechSynthesis.speaking) {\r\n    window.speechSynthesis.cancel();\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}